<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <title>Django深入学习笔记</title> <meta name="description" content="Django REST framework媒体文件序列化，文档生成，输入检测"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://localhost:4000/%E6%8A%80%E6%9C%AF/2019/05/01/django-drf-learn.html"> <link rel="alternate" type="application/rss+xml" title="Fank" href="http://localhost:4000/feed.xml" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:fankcoder@gmail.com" class="sidebar-social-icon email"></a> <a href="http://www.weibo.com/u/2424646683" class="sidebar-social-icon weibo" target="_blank"></a> <a href="https://github.com/fankcoder" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="备忘">备忘</li> <li class="sidebar-tag" data-filter="工具">工具</li> <li class="sidebar-tag" data-filter="技术">技术</li> <li class="sidebar-tag" data-filter="生活">生活</li> <li class="sidebar-tag" data-filter="About">About</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2019/05/21/MySQL-optimize.html"> MySQL亿级表优化 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2019/05/01/django-drf-learn.html"> Django深入学习笔记 </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2019/04/28/fix-chrome-darkmode.html"> 在mojave深色模式下，禁用chrome的深色主题 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2019/04/04/general-docker.html"> Docker 常用 </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2019/04/02/ss_config.html"> 第N次折腾vps科学上网，解决方案笔记 </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2019/03/08/vscode.html"> vscode配置手册 </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2019/03/08/mac-tools.html"> mac使用手册 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2019/03/08/python-deep.html"> Python深入学习笔记 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2019/03/08/appspider-tools.html"> Ubuntu&OSX的app抓包方案 </a> <a class="toc-link" data-tags="About" href="/about/2019/03/08/HeyUFindMe.html"> Hey, U find me! </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2019/02/01/vim.html"> vim使用手册 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2019/01/15/general-javascript-resources.html"> JavaScript 常用资源 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2019/01/12/threading-python.html"> Python线程&进程&协程&asyncio </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2019/01/02/algorithem.html"> 算法&数据结构 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2019/01/01/SQL-pratice.html"> SQL练习 </a> <a class="toc-link" data-tags="生活" href="/%E7%94%9F%E6%B4%BB/2019/01/01/life-time-manage.html"> 时间和人生感悟 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/11/01/chmod.html"> chmod命令 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/03/10/screen-linux.html"> screen工具 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/03/08/todolist-django-python.html"> Todolist 应用 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2016/03/04/general-linux-resources.html"> Linux 常用资源 </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2016/01/28/good-tools.html"> 神器收藏 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2016/01/27/general-django-resource.html"> Django命令备忘录 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/25/amazon-spider-python.html"> 爬虫防屏蔽 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/20/add-static-django-python.html"> Django添加静态文件 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/11/encode-python.html"> Python转码问题 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/12/29/xrange-python.html"> Python的xrange和range </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2015/11/10/vpn-tools.html"> 科学上网列表 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/26/email-shell-linux.html"> Shell每日发邮件 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/13/passwd-python.html"> Python密码处理 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/12/os-python.html"> Python标准库os </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/08/25/re-python.html"> Python正则 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/08/11/func-python.html"> Python内置函数(map、reduce、filter) </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/07/25/awk-linux.html"> AWK </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/07/24/blog-django-python.html"> Django练习项目之搭建博客 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/05/22/xlrd-python.html"> 用xlrd\xlwt读写excel </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/01/01/chromium-flash-linux.html"> chromium安装flash </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2014/12/24/ubuntu-tools.html"> Ubuntu常用 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/09/15/general-git-resources.html"> Git 常用命令 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/05/11/general-mysql-resources.html"> MySQL常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/04/23/general-bootstrap-resources.html"> Bootstrap常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-svn-resources.html"> SVN 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-shell-resources.html"> Shell 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-python-resources.html"> Python 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-jquery-resources.html"> jQuery 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-html-resources.html"> HTML 常用 </a> </nav> </div> </aside> <main id="main"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2019 May 01</span> <span class="post-meta-span tag">Django, drf</span> </div> <h1 class="post-title">Django深入学习笔记</h1> <h2 id="django-rest-framework">Django REST framework</h2> <p>媒体文件序列化，文档生成，输入检测</p> <p>web browable API</p> <p>OAuth1,2 第三方登录</p> <p>serializaion 序列化ORMdata 类似django form</p> <h4 id="启用drf">启用drf</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSTALLED_APPS = (
...
'rest_framework',
)
</code></pre></div></div> <h4 id="调试api">调试api</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.conf.urls import url, include
urlpatterns = [
    ...
    url(r'^api-auth/', include('rest_framework.urls'))
]
</code></pre></div></div> <h4 id="使用modelserializers">使用ModelSerializers</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">class</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
<span class="p">#</span><span class="err">自定义序列化</span>
<span class="n">category</span> <span class="p">=</span> <span class="n">CategorySerializer</span><span class="p">()</span>
<span class="n">class</span> <span class="n">Meta</span><span class="p">:</span>
    <span class="k">model</span> <span class="p">=</span> <span class="n">Snippet</span>
    <span class="n">fields</span> <span class="p">=</span> <span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">,</span> <span class="s1">'code'</span><span class="p">,</span> <span class="s1">'linenos'</span><span class="p">,</span> <span class="s1">'language'</span><span class="p">,</span> <span class="s1">'style'</span><span class="p">)</span>
    <span class="p">#</span><span class="err">将所有字段快速添加方法</span>
    <span class="n">fields</span> <span class="p">=</span> <span class="s2">"__all__"</span>
</code></pre></div></div> <h4 id="view层级关系">view层级关系</h4> <p>GenericViewSet(viewset) -drf GenericAPIView -drf APIView -drf View -django</p> <h4 id="mixin">mixin</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CreateModelMixin
ListModelMixin
RetrieveModelMixin
UpdateModelMixin
DestroyModelMixin
</code></pre></div></div> <h4 id="如何通过配置分页">如何通过配置分页</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drf源码-&gt; settings -&gt; default -&gt;DEFAULT_PAGINATION_CLASS
REST_FRAMEWORK = {
    'PAGE_SIZE':10,
}

这时接口返回结果会有count，next，previous字段，方便前端分页使用
</code></pre></div></div> <h4 id="自定义分页">自定义分页</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from rest_framework.pageination import PageNumberPagination

class GoodsPagination(PageNumberPagination):
    page_size = 10
    page_size_query_ param = 'page_size' #每页大小
    page_query_param = 'p' #第几页p
    max_page_size = 100
</code></pre></div></div> <h4 id="目录结构">目录结构</h4> <p>db_tools #数据库初始化脚本 extra_apps #额外第三方库</p> <h4 id="拓展modelspy">拓展models.py</h4> <p>from django.contrib.auth.models import AbstractUser</p> <h4 id="替换系统用户">替换系统用户</h4> <p>settings.py添加AUTH_USER_MODEL = ‘user.UserProfile’</p> <h4 id="编辑器">编辑器</h4> <p>djangoUeidtor</p> <h4 id="返回usermodel">返回usermodel</h4> <p>from django.contrib.auth import get_user_mode</p> <h4 id="makemigrations">makemigrations</h4> <p>当执行makemigrations时，会在对应app下创建migrations文件夹，并生产py文件</p> <h4 id="migrate">migrate</h4> <p>执行，可以加app name指定 migrate如何知道该运行哪个py文件，django会查询django_migrations表，如果执行过，则跳过。</p> <p>django的migration功能在多服务该表时非常好用</p> <p>修改表结构，尽量使用改代码方式，直接改表结构极易出错</p> <h3 id="xadmin">xadmin</h3> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>在installed_apps添加crispy_forms
</code></pre></div></div> <h4 id="创建超级用户">创建超级用户</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>登录不了可能是密码设置太简单，就改密码
python manage.py changepassword admin
</code></pre></div></div> <h3 id="前后端分离优缺点">前后端分离优缺点</h3> <ol> <li>pc, app, pad 多端</li> <li>SPA开发模式开始流行（单页面）</li> <li>template谁来写</li> <li>开发效率，互相等待</li> <li>前端一直配合后端</li> <li>开发语言耦合，换语言困难</li> </ol> <p>缺点</p> <ol> <li>前端学习门槛增加</li> <li>数据非常依赖文档，详细，及时更新</li> <li>前端工作量增大</li> <li>seo难度增大</li> </ol> <h3 id="restful-api">restful api</h3> <p>restful api目前是前后端分离最佳实践，是一套标准规范</p> <ol> <li>轻量、直接通过http,不需要额外协议， post/get/put/delete等</li> <li>面向资源，一目了然，具有自解释性</li> <li>数据描述简单，一般通过json或xml做数据通信</li> </ol> <p>HTTP是一个无状态协议。客户端想要操作服务器，需要通过 post/get/put/delete让服务器发生状态转移化</p> <ol> <li>每个URI代表一种资源</li> <li>客户端和服务器之间，传递这种资源的某种表现层</li> <li>客户端通过HTTP动词让服务器发生状态转移化</li> </ol> <p>例子</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /zoos：列出所有动物园
POST /zoos：新建一个动物园
GET /zoos/ID：获取某个指定动物园的信息
PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）
PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）
DELETE /zoos/ID：删除某个动物园
GET /zoos/ID/animals：列出某个指定动物园的所有动物
DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物
</code></pre></div></div> <p>过滤信息</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?limit=10：指定返回记录的数量
?offset=10：指定返回记录的开始位置。
?page=2&amp;per_page=100：指定第几页，以及每页的记录数。
?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。
?animal_type_id=1：指定筛选条件
</code></pre></div></div> <p>状态码</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。
201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。
202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）
204 NO CONTENT - [DELETE]：用户删除数据成功。
400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。
401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。
403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。
404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。
406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。
410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。
422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。
500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。
</code></pre></div></div> <h4 id="将model转为dict">将model转为dict</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.forms.models import model_to_dict
for good in goods:
    _dict.append(good)
</code></pre></div></div> <h4 id="seriallzers将imagefile和datetime快速序列化">seriallzers将imagefile和datetime快速序列化</h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.core import seriallzers
json_data = serializers.serialize("json", goods)
json_data = json_data.loads(json_data)
return json_data
</code></pre></div></div> <h4 id="jsonresponse">JsonResponse</h4> <p>简化httpresponse</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.http import JsonResponse
return JsonResponse(json_data, safe=False)
</code></pre></div></div> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://localhost:4000/%E6%8A%80%E6%9C%AF/2019/05/01/django-drf-learn.html&text=Django深入学习笔记" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://localhost:4000/%E6%8A%80%E6%9C%AF/2019/05/01/django-drf-learn.html&title=Django深入学习笔记" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://localhost:4000/%E6%8A%80%E6%9C%AF/2019/05/01/django-drf-learn.html&title=Django深入学习笔记" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> <!-- --> </body> </html>
