<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <title>AWK</title> <meta name="description" content="Awk是一种便于使用且表达能力强的程序设计语言，可应用于各种计算和数据处理任务。"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://localhost:4000/%E6%8A%80%E6%9C%AF/2015/07/25/awk-linux.html"> <link rel="alternate" type="application/rss+xml" title="Fank" href="http://localhost:4000/feed.xml" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:fankcoder@gmail.com" class="sidebar-social-icon email"></a> <a href="https://github.com/https://github.com/fankcoder" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="备忘">备忘</li> <li class="sidebar-tag" data-filter="工具">工具</li> <li class="sidebar-tag" data-filter="技术">技术</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="" href="/2019/03/08/vscode.html"> Vscode </a> <a class="toc-link" data-tags="" href="/2019/03/08/mac-tools.html"> Mac Tools </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/11/01/chmod.html"> chmod命令 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/03/10/screen-linux.html"> screen工具 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/03/08/todolist-django-python.html"> Todolist 应用 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2016/03/04/general-linux-resources.html"> Linux 常用资源 </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2016/01/28/good-tools.html"> 神器收藏 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2016/01/27/general-django-resource.html"> Django命令备忘录 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/25/amazon-spider-python.html"> 爬虫防屏蔽 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/20/add-static-django-python.html"> Django添加静态文件 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/12/threading-python.html"> Python 多线程 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2016/01/11/encode-python.html"> Python转码问题 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/12/29/xrange-python.html"> Python的xrange和range </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2015/11/10/vpn-tools.html"> 科学上网列表 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/26/email-shell-linux.html"> Shell每日发邮件 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/13/passwd-python.html"> Python密码处理 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/10/12/os-python.html"> Python标准库os </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/08/25/re-python.html"> Python正则 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/08/11/func-python.html"> Python内置函数(map、reduce、filter) </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/07/25/awk-linux.html"> AWK </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/07/24/blog-django-python.html"> Django练习项目之搭建博客 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/05/22/xlrd-python.html"> 用xlrd\xlwt读写excel </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2015/02/13/general-seo-resources.html"> SEO 常用资源 </a> <a class="toc-link" data-tags="技术" href="/%E6%8A%80%E6%9C%AF/2015/01/01/chromium-flash-linux.html"> chromium安装flash </a> <a class="toc-link" data-tags="工具" href="/%E5%B7%A5%E5%85%B7/2014/12/24/ubuntu-tools.html"> Ubuntu常用 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/09/15/general-git-resources.html"> Git 常用命令 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/08/03/general-mac-resources.html"> Mac 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/05/11/general-mysql-resources.html"> MySQL常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/04/23/general-bootstrap-resources.html"> Bootstrap常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-svn-resources.html"> SVN 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-shell-resources.html"> Shell 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-python-resources.html"> Python 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-php-resources.html"> PHP 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-jquery-resources.html"> jQuery 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-javascript-resources.html"> JavaScript 常用资源 </a> <a class="toc-link" data-tags="备忘" href="/%E5%A4%87%E5%BF%98/2014/01/15/general-html-resources.html"> HTML 常用 </a> </nav> </div> </aside> <main id="main"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2015 July 25</span> <span class="post-meta-span tag">awk</span> </div> <h1 class="post-title">AWK</h1> <p>Awk是一种便于使用且表达能力强的程序设计语言，可应用于各种计算和数据处理任务。</p> <h3 id="起步">起步</h3> <p>有用的awk程序往往很简短，仅仅一两行。假设你有一个名为 emp.data 的文件，其中包含员工的姓名、薪资（美元/小时）以及小时数，一个员工一行数据，如下所示：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Beth	4.00	0
Dan	3.75	0
kathy	4.00	10
Mark	5.00	20
Mary	5.50	22
Susie	4.25	18
</code></pre></div></div> <p>现在你想打印出工作时间超过零小时的员工的姓名和工资（薪资乘以时间）。这种任务对于awk来说就是小菜一碟。输入这个命令行就可以了：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk '$3 &gt;0 { print $1, $2 * $3 }' emp.data
</code></pre></div></div> <p>你应该会得到如下输出：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Kathy 40
Mark 100
Mary 121
Susie 76.5
</code></pre></div></div> <p>该命令行告诉系统执行引号内的awk程序，从输入文件 emp.data 获取程序所需的数据。引号内的部分是个完整的awk程序，包含单个模式-动作语句。模式 $3&gt;0 用于匹配第三列大于0的输入行，动作:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ print $1, $2 * $3 }
</code></pre></div></div> <p>打印每个匹配行的第一个字段以及第二第三字段的乘积。</p> <p>如果你想打印出还没工作过的员工的姓名，则输入命令行：:</p> <p>awk ‘$3 == 0 { print $1 }’ emp.data 这里，模式 $3 == 0 匹配第三个字段等于0的行，动作:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ awk ‘$3 &gt; 0 { print $1, $2 * $3 }’ emp.data
Kathy 40
Mark 100
Mary 121
Susie 76.5
$ awk ‘$3 == 0 { print $1 }’ emp.data
Beth
Dan
$
</code></pre></div></div> <p>行首的 $ 是系统提示符，也许在你的机器上不一样。</p> <h3 id="awk程序的结构">AWK程序的结构</h3> <p>上述的命令行中，引号之间的部分是awk编程语言写就的程序。</p> <p>awk的基本操作是一行一行地扫描输入，搜索匹配任意程序中模式的行。词语“匹配”的准确意义是视具体的模式而言，对于模式 $3 &gt;0 来说，意思是“条件为真”。</p> <h3 id="执行awk程序">执行AWK程序</h3> <p>执行awk程序的方式有多种。你可以输入如下形式的命令行：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk 'program' input files
</code></pre></div></div> <p>从而在每个指定的输入文件上执行这个program。例如，你可以输入：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk '$3 == 0 { print $1 }' file1 file2
</code></pre></div></div> <p>打印file1和file2文件中第三个字段为0的每一行的第一个字段。</p> <p>你可以省略命令行中的输入文件，仅输入：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk 'program'
</code></pre></div></div> <p>这种情况下，awk会将program应用于你在终端中接着输入的任意数据行，直到你输入一个文件结束信号（Unix系统上为control-d）。如下是Unix系统的一个会话示例：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ awk ‘$3 == 0 { print $1 }’
Beth 4.00 0
Beth

Dan 3.75 0
Dan

Kathy 3.75 10
Kathy 3.75 0
Kathy

...
</code></pre></div></div> <p>这个动作非常便于尝试awk：输入你的程序，然后输入数据，观察发生了什么。</p> <p>注意命令行中的程序是用单引号包围着的。这会防止shell解释程序中 $ 这样的字符，也允许程序的长度超过一行。</p> <p>当程序比较短小（几行的长度）的时候，这种约定会很方便。然而，如果程序较长，将程序写到一个单独的文件中会更加方便。假设存在程序 progfile ，输入命令行：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk -f progfile     optional list of input files
</code></pre></div></div> <p>其中 -f 选项指示awk从指定文件中获取程序。可以使用任意文件名替换 progfile 。</p> <h3 id="错误">错误</h3> <p>如果你的awk程序存在错误，awk会给你一段诊断信息。例如，如果你打错了大括号，如下所示：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk '$3 == 0 [ print $1 }' emp.data
你会得到如下信息：

awk: syntax error at source line 1
context is
$3 == 0 &gt;&gt;&gt; [ &lt;&lt;&lt;
extra }
missing ]
awk: bailing out at source line 1
</code></pre></div></div> <p>“Syntax error”意味着在 »&gt; «&lt; 标记的地方检测到语法错误。“Bailing out”意味着没有试图恢复。有时你会得到更多的帮助-关于错误是什么，比如大括号或括弧不匹配。</p> <p>因为存在句法错误，awk就不会尝试执行这个程序。然而，有些错误，直到你的程序被执行才会检测出来。</p> <h3 id="nf-字段数量">NF, 字段数量</h3> <p>Awk会对当前输入的行有多少个字段进行计数, 并且将当前行的字段数量存 储在一个内建的称作 NF 的变量中. 因此, 下面的程序</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ print NF, $1, $NF }
</code></pre></div></div> <p>会依次打印出每一行的字段数量, 第一个字段的值, 最后一个字段的值.</p> <h3 id="打印行号">打印行号</h3> <p>Awk提供了另一个内建变量, 叫做 NR, 它会存储当前已经读取了多少行的计数. 我们可以使用 NR 和 $0 给 emp.data 的没一行加上行号:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ print NR, $0 }
</code></pre></div></div> <p>打印的输出看起来会是这样:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 Beth   4.00     0
2 Dan    3.75     0
3 Kathy  4.00    10
4 Mark   5.00    20
5 Mary   5.50    22
6 Susie  4.25   1 8
</code></pre></div></div> <p>在输出中添加内容</p> <p>你当然也可以在字段中间或者计算的值中间打印输出想要的内容:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ print "total pay for", $1, "is", $2 * $3 }
输出

total pay for Beth is 0
total pay for Dan is 0
total pay for Kathy is 40
total pay for Mark is 100
total pay for Mary is 121
total pay for Susie is 76.5
</code></pre></div></div> <p>在打印语句中, 双引号内的文字将会在字段和计算的值中插入输出.</p> <h3 id="高级输出">高级输出</h3> <p>print 语句可用于快速而简单的输出。若要严格按照你所想的格式化输出，则需要使用 printf 语句。 printf 几乎可以产生任何形式的输出</p> <p>printf 语句的形式如下：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>printf(format, value1, value2, ..., valuen)
</code></pre></div></div> <p>其中 format 是字符串，包含要逐字打印的文本，穿插着 format 之后的每个值该如何打印的规格(specification)。一个规格是一个 % 符，后面跟着一些字符，用来控制一个 value 的格式。第一个规格说明如何打印 value1 ，第二个说明如何打印 value2 ，… 。因此，有多少 value 要打印，在 format 中就要有多少个 % 规格。</p> <p>使用 printf 打印每位员工的总薪酬：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ printf("total pay for %s is $%.2f\n", $1, $2 * $3) }
</code></pre></div></div> <p>printf 语句中的规格字符串包含两个 % 规格。第一个是 %s ，说明以字符串的方式打印第一个值 $1 。第二个是 %.2f ，说明以数字的方式打印第二个值 $2*$3 ，并保留小数点后面两位。规格字符串中其他东西，包括美元符号，仅逐字打印。字符串尾部的 \n 代表开始新的一行，使得后续输出将从下一行开始。以 emp.data 为输入，该程序产生：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total pay for Beth is $0.00
total pay for Dan is $0.00
total pay for Kathy is $40.00
total pay for Mark is $100.00
total pay for Mary is $121.00
total pay for Susie is $76.50
</code></pre></div></div> <p>printf 不会自动产生空格或者新的行，必须是你自己来创建，所以不要忘了 \n 。</p> <p>打印每位员工的姓名与薪酬：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ printf("%-8s $%6.2f\n", $1, $2 * $3) }
</code></pre></div></div> <p>第一个规格 %-8s 将一个姓名以字符串形式在8个字符宽度的字段中左对齐输出。第二个规格 %6.2f 将薪酬以数字的形式，保留小数点后两位，在6个字符宽度的字段中输出。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Beth     $  0.00
Dan      $  0.00
Kathy    $ 40.00
Mark     $100.00
Mary     $121.00
Susie    $ 76.50
</code></pre></div></div> <p>之后我们将展示更多的 printf 示例。一切精彩尽在2.4小节。</p> <h3 id="排序输出">排序输出</h3> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk '{ printf("%6.2f    %s\n", $2 * $3, $0) }' emp.data | sort
</code></pre></div></div> <p>将awk的输出通过管道传给 sort 命令，输出为：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  0.00    Beth  4.00 0
  0.00    Dan   3.75 0
 40.00    Kathy 4.00 10
 76.50    Susie 4.25 18
100.00    Mark  5.00 20
121.00    Mary  5.50 22
</code></pre></div></div> <h3 id="选择">选择</h3> <p>对比选择</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$2 * $3 &gt; 50 { printf("$%.2f for %s\n", $2 * $3, $1) }
</code></pre></div></div> <p>打印出总薪资超过50美元的员工的薪酬。</p> <p>文本内容选择</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$1 == "Susie"
</code></pre></div></div> <p>操作符 == 用于测试相等性。你也可以使用称为 正则表达式 的模式查找包含任意字母组合，单词或短语的文本。这个程序打印任意位置包含 Susie 的行：</p> <p>/Susie/ 输出为这一行：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Susie   4.25    18
</code></pre></div></div> <p>正则表达式可用于指定复杂的多的模式</p> <h3 id="模式组合">模式组合</h3> <table> <tbody> <tr> <td>可以使用括号和逻辑操作符与 &amp;&amp; ， 或</td> <td> </td> <td>， 以及非 ! 对模式进行组合。程序:</td> </tr> </tbody> </table> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$2 &gt;= 4 || $3 &gt;= 20
</code></pre></div></div> <p>会打印 $2 (第二个字段) 大于等于 4 或者 $3 (第三个字段) 大于等于 20 的行：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Beth    4.00    0
kathy   4.00    10
Mark    5.00    20
Mary    5.50    22
Susie   4.25    18
</code></pre></div></div> <h3 id="begin与end">BEGIN与END</h3> <p>特殊模式 BEGIN 用于匹配第一个输入文件的第一行之前的位置， END 则用于匹配处理过的最后一个文件的最后一行之后的位置。这个程序使用 BEGIN 来输出一个标题：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BEGIN { print "Name    RATE    HOURS"; print ""}
      { print }
</code></pre></div></div> <p>输出为：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME    RATE    HOURS

Beth    4.00    0
Dan     3.75    0
Kathy   4.00    10
Mark    5.00    20
Mary    5.50    22
Susie   4.25    18
</code></pre></div></div> <p>程序的动作部分你可以在一行上放多个语句，不过要使用分号进行分隔。注意 普通的 print 是打印当前输入行，与之不同的是 print “” 会打印一个空行。</p> <h3 id="使用awk进行计算">使用AWK进行计算</h3> <h4 id="计数">计数</h4> <p>这个程序使用一个变量 emp 来统计工作超过15个小时的员工的数目：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$3 &gt; 15 { emp = emp + 1 }
END     { print emp, "employees worked more than 15 hours" }
</code></pre></div></div> <p>对于第三个字段超过15的每行， emp 的前一个值加1。以 emp.data 为输入，该程序产生：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3 employees worked more than 15 hours
</code></pre></div></div> <p>用作数字的awk变量的默认初始值为0，所以我们不需要初始化 emp 。</p> <h4 id="求和与平均值">求和与平均值</h4> <p>为计算员工的数目，我们可以使用内置变量 NR ，它保存着到目前位置读取的行数；在所有输入的结尾它的值就是所读的所有行数。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>END { print NR, "employees" }
</code></pre></div></div> <p>输出为：</p> <p>6 employees</p> <p>如下是一个使用 NR 来计算薪酬均值的程序：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    { pay = pay + $2 * $3 }
END { print NR, "employees"
      print "total pay is", pay
      print "average pay is", pay/NR
    }
</code></pre></div></div> <p>第一个动作累计所有员工的总薪酬。 END 动作打印出</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>6 employees
total pay is 337.5
average pay is 56.25
</code></pre></div></div> <p>很明显， printf 可用来产生更简洁的输出。并且该程序也有个潜在的错误：在某种不太可能发生的情况下， NR 等于0，那么程序会试图执行零除，从而产生错误信息。</p> <h4 id="字符串连接">字符串连接</h4> <p>可以合并老字符串来创建新字符串。这种操作称为 连接（concatenation） 。程序</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    { names = names $1 " "}
END { print names }
</code></pre></div></div> <p>通过将每个姓名和一个空格附加到变量 names 的前一个值， 来将所有员工的姓名收集进单个字符串中。最后 END 动作打印出 names 的值：</p> <p>Beth Dan Kathy Mark Mary Susie</p> <p>awk程序中，连接操作的表现形式是将字符串值一个接一个地写出来。对于每个输入行，程序的第一个语句先连接三个字符串： names 的前一个值、当前行的第一个字段以及一个空格，然后将得到的字符串赋值给 names 。</p> <p>因此，读取所有的输入行之后， names 就是个字符串，包含所有员工的姓名，每个姓名后面跟着一个空格。用于保存字符串的变量的默认初始值是空字符串(也就是说该字符串包含零个字符)，因此这个程序中的 names 不需要显式初始化。</p> <h4 id="内置函数">内置函数</h4> <p>我们已看到awk提供了内置变量来保存某些频繁使用的数量，比如：字段的数量和输入行的数量。类似地，也有内置函数用来计算其他有用的数值。除了平方根、对数、随机数诸如此类的算术函数，也有操作文本的函数。其中之一是 length ，计算一个字符串中的字符数量。例如，这个程序会计算每个人的姓名的长度：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ print $1, length($1) }
结果：:

Beth 4
Dan 3
Kathy 5
Mark 4
Mary 4
Susie 5
</code></pre></div></div> <p>行、单词以及字符的计数</p> <h3 id="控制语句">控制语句</h3> <p>Awk为选择提供了一个 if-else 语句，以及为循环提供了几个语句，所以都效仿C语言中对应的控制语句。它们仅可以在动作中使用。</p> <h4 id="if-else语句">if-else语句</h4> <p>如下程序将计算时薪超过6美元的员工的总薪酬与平均薪酬。它使用一个 if 来防范计算平均薪酬时的零除问题。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$2 &gt; 6 { n = n + 1; pay = pay + $2 * $3 }
END    { if (n &gt; 0)
            print n, "employees, total pay is", pay,
                     "average pay is", pay/n
         else
             print "no employees are paid more than $6/hour"
        }
</code></pre></div></div> <p>emp.data 的输出是：:</p> <p>no employees are paid more than $6/hour</p> <p>if-else 语句中，if 后的条件会被计算。如果为真，执行第一个 print 语句。否则，执行第二个 print 语句。注意我们可以使用一个逗号将一个长语句截断为多行来书写。</p> <p>while语句</p> <p>一个 while 语句有一个条件和一个执行体。条件为真时执行体中的语句会被重复执行。这个程序使用公式</p> <p>value=amount(1+rate)yearsvalue=amount(1+rate)years</p> <p>来演示以特定的利率投资一定量的钱，其数值是如何随着年数增长的。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># interest1 - 计算复利
#   输入: 钱数    利率    年数
#   输出: 复利值

{   i = 1
    while (i &lt;= $3) {
        printf("\t%.2f\n", $1 * (1 + $2) ^ i)
        i = i + 1
    }
}
</code></pre></div></div> <p>条件是 while 后括弧包围的表达式；循环体是条件后大括号包围的两个表达式。 printf 规格字符串中的 \t 代表制表符； ^ 是指数操作符。从 # 开始到行尾的文本是注释，会被awk忽略，但能帮助程序的读者理解程序做的事情。</p> <h4 id="for语句">for语句</h4> <p>另一个语句， for ，将大多数循环都包含的初始化、测试、以及自增压缩成一行。如下是之前利息计算的 for 版本：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># interest1 - 计算复利
#   输入: 钱数    利率    年数
#   输出: 每年末的复利

{ for (i = 1; i &lt;= $3; i = i + 1)
    printf("\t%.2f\n", $1 * (1 + $2) ^ i)
}
</code></pre></div></div> <p>初始化 i = 1 只执行一次。接下来，测试条件 i &lt;= $3 ；如果为真，则执行循环体的 printf 语句。循环体执行结束后执行自增 i = i + 1 ，接着由另一次条件测试开始下一个循环迭代。代码更加紧凑，并且由于循环体仅是一条语句，所以不需要大括号来包围它。</p> <h3 id="数组">数组</h3> <p>awk为存储一组相关的值提供了数组。虽然数组给予了awk很强的能力，但在这里我们仅展示一个简单的例子。如下程序将按行逆序打印输入。第一个动作将输入行存为数组 line 的连续元素；即第一行放在 line[1] ，第二行放在 line[2] , 依次继续。 END 动作使用一个 while 语句从后往前打印数组中的输入行：:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 反转 - 按行逆序打印输入

    { line[NR] = $0 }  # 记下每个输入行

END { i = NR           # 逆序打印
      while (i &gt; 0) {
        print line[i]
        i = i - 1
      }
    }
    
</code></pre></div></div> <p>以 emp.data 为输入，输出为</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Susie    4.25   18
Mary     5.50   22
Mark     5.00   20
Kathy    4.00   10
Dan      3.75   0
Beth     4.00   0
</code></pre></div></div> <p>如下是使用 for 语句实现的相同示例：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# 反转 - 按行逆序打印输入

    { line[NR] = $0 }   # 记下每个输入行

END { for (i = NR; i &gt; 0; i = i - 1)
        print line[i]
    }
</code></pre></div></div> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://localhost:4000/%E6%8A%80%E6%9C%AF/2015/07/25/awk-linux.html&text=AWK" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://localhost:4000/%E6%8A%80%E6%9C%AF/2015/07/25/awk-linux.html&title=AWK" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://localhost:4000/%E6%8A%80%E6%9C%AF/2015/07/25/awk-linux.html&title=AWK" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> </body> </html>
